// Generated by CoffeeScript 1.7.1
var __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

define(['marionette', 'text!apps/plans/templates/changePlanLayout.html', 'text!apps/plans/templates/paymentForm.html', 'text!apps/plans/templates/paymentCard.html', 'braintree', 'card'], function(Marionette, changePlanTpl, paymentFormTpl, paymentCardTpl, BrainTree, card) {
  var ChangePlanLayout, DomainSubscriptionView, PaymentCardView, PaymentFormView, SelectedPlanView;
  ChangePlanLayout = (function(_super) {
    __extends(ChangePlanLayout, _super);

    function ChangePlanLayout() {
      return ChangePlanLayout.__super__.constructor.apply(this, arguments);
    }

    ChangePlanLayout.prototype.template = changePlanTpl;

    ChangePlanLayout.prototype.regions = {
      domainSubscriptionRegion: '#active-subscription',
      selectedPlanRegion: '#selected-plan',
      paymentViewRegion: '#payment-form'
    };

    return ChangePlanLayout;

  })(Marionette.Layout);
  DomainSubscriptionView = (function(_super) {
    __extends(DomainSubscriptionView, _super);

    function DomainSubscriptionView() {
      return DomainSubscriptionView.__super__.constructor.apply(this, arguments);
    }

    DomainSubscriptionView.prototype.template = ' <div class="col-md-3"> <div class="tiles-body"> <div >Domain name </div> <div class="heading"> <span class="animate-number" >{{post_title}}</span> </div> </div> </div> <div class="col-md-3"> <div class="tiles-body"> <div > Active plan </div> <div class="heading"> <span class="animate-number" >{{plan_name}}</span> </div> </div> </div> <div>To ensure the plan is always active for your domain, enter valid card details below.Its easy to change your card information. Simply click on the change card button below and the current card details will be replaced by new card for the next billing cycle</div>';

    DomainSubscriptionView.prototype.className = 'row';

    return DomainSubscriptionView;

  })(Marionette.ItemView);
  SelectedPlanView = (function(_super) {
    __extends(SelectedPlanView, _super);

    function SelectedPlanView() {
      return SelectedPlanView.__super__.constructor.apply(this, arguments);
    }

    SelectedPlanView.prototype.template = '<h4 class="semi-bold">Selected plan</h3> <div class="grid simple"> <h3 class="bold text-center">{{plan_name}}<br> <small class="text-danger"> Rs.{{price}}/month</small> </h2> <hr> <ul class="list-unstyled text-center"> <li>Multiple Email Accounts</li> <li>99.9% Uptime</li> <li>Enterprise Level Storage</li> <li>Fully Managed VPS</li> <li>Reliable 24/7/365 Support</li> <li>Enterprise Level Storage</li> <li>Fully Managed VPS</li> <li>Reliable 24/7/365 Support</li> </ul> <p class="text-danger">Note:</p> <p class="text-muted">Any change of plans in the midddle of cycle will be applicable from new cycle</p> </div>';

    SelectedPlanView.prototype.className = 'alert alert-info';

    return SelectedPlanView;

  })(Marionette.ItemView);
  PaymentCardView = (function(_super) {
    __extends(PaymentCardView, _super);

    function PaymentCardView() {
      return PaymentCardView.__super__.constructor.apply(this, arguments);
    }

    PaymentCardView.prototype.template = paymentCardTpl;

    PaymentCardView.prototype.events = function() {
      return {
        'click #submit': function() {
          var braintree, clientSideEncryptionKey, creditCardToken;
          creditCardToken = this.model.get('token');
          clientSideEncryptionKey = "MIIBCgKCAQEA0fQXY7zHRl2PSEoZGOWDseI9MTDz2eO45C5M27KhN/HJXqi7sj8UDybrZJdsK+QL4Cw55r285Eeka+a5tAciEqd3E6YXkNokVmgo6/Wg21vYJKRvcnLkPE+J5iBFfQBBEMNKZMALl1P7HHkfOJsFZNO9+YOfiE+wl0QC8SnjZApftJ69ibbuFdFSR3L4kP6tZSQWeJS9WnkDzxGvRUyGFfs26x/q7Kxn+hdXkxTDd1o8FhjTCP/EkmHxhhJyYgzagtbJ84nxaLBuz6yW8bx5Qwt1ZiWUVVUIJlMiQtXUP05CId+aMIV8wX3OWtyAmTpn8N++tXYGjt/kY/bf8oY3yQIDAQAB";
          braintree = Braintree.create(clientSideEncryptionKey);
          creditCardToken = braintree.encrypt(creditCardToken);
          this.trigger("user:card:payment", creditCardToken);
          return this.$el.find('.loader').show();
        },
        'click #change-card': function() {
          return this.trigger("change:card:clicked");
        }
      };
    };

    PaymentCardView.prototype.onPaymentSucess = function(response, domainId) {
      var msg, msgText;
      this.$el.find('#success-msg').empty();
      msgText = response.msg;
      msg = "<div class='alert alert-success'> <button class='close' data-dismiss='alert'>&times;</button> " + msgText + "<div>";
      return this.$el.find('#success-msg').append(msg);
    };

    PaymentCardView.prototype.redirectPage = function(redirect_url) {
      return window.location.href = redirect_url;
    };

    return PaymentCardView;

  })(Marionette.ItemView);
  PaymentFormView = (function(_super) {
    __extends(PaymentFormView, _super);

    function PaymentFormView() {
      return PaymentFormView.__super__.constructor.apply(this, arguments);
    }

    PaymentFormView.prototype.template = paymentFormTpl;

    PaymentFormView.prototype.onShow = function() {
      var cardExists;
      this.$el.find('.active form').card({
        container: this.$el.find('.card-wrapper')
      });
      cardExists = this.model.get('card_exists');
      if (cardExists) {
        return this.$el.find('.cancel-card').show();
      }
    };

    PaymentFormView.prototype.onPaymentSucess = function(response, domainId) {
      var msg, msgText;
      this.$el.find('#success-msg').empty();
      msgText = response.msg;
      msg = "<div class='alert alert-success'> <button class='close' data-dismiss='alert'>&times;</button> " + msgText + "<div>";
      return this.$el.find('#success-msg').append(msg);
    };

    PaymentFormView.prototype.redirectPage = function(redirect_url) {
      return window.location.href = redirect_url;
    };

    PaymentFormView.prototype.events = function() {
      return {
        'click #submit': function() {
          var braintree, cardholderName, clientSideEncryptionKey, creditCardCvv, creditCardNumber, data, expirationDate;
          creditCardNumber = this.$el.find('#credit_card_number').val();
          cardholderName = this.$el.find('#cardholder_name').val();
          expirationDate = this.$el.find('#expiration_date').val();
          creditCardCvv = this.$el.find('#credit_card_cvv').val();
          clientSideEncryptionKey = "MIIBCgKCAQEA0fQXY7zHRl2PSEoZGOWDseI9MTDz2eO45C5M27KhN/HJXqi7sj8UDybrZJdsK+QL4Cw55r285Eeka+a5tAciEqd3E6YXkNokVmgo6/Wg21vYJKRvcnLkPE+J5iBFfQBBEMNKZMALl1P7HHkfOJsFZNO9+YOfiE+wl0QC8SnjZApftJ69ibbuFdFSR3L4kP6tZSQWeJS9WnkDzxGvRUyGFfs26x/q7Kxn+hdXkxTDd1o8FhjTCP/EkmHxhhJyYgzagtbJ84nxaLBuz6yW8bx5Qwt1ZiWUVVUIJlMiQtXUP05CId+aMIV8wX3OWtyAmTpn8N++tXYGjt/kY/bf8oY3yQIDAQAB";
          braintree = Braintree.create(clientSideEncryptionKey);
          creditCardNumber = braintree.encrypt(creditCardNumber);
          cardholderName = braintree.encrypt(cardholderName);
          expirationDate = braintree.encrypt(expirationDate);
          creditCardCvv = braintree.encrypt(creditCardCvv);
          data = {
            'creditCardNumber': creditCardNumber,
            'cardholderName': cardholderName,
            'expirationDate': expirationDate,
            'creditCardCvv': creditCardCvv,
            'braintree_customer_id': this.model.get('braintree_customer_id')
          };
          this.trigger("user:credit:card:details", data);
          return this.$el.find('.loader').show();
        },
        'click #cancel': function() {
          return this.trigger("use:stored:card");
        }
      };
    };

    return PaymentFormView;

  })(Marionette.ItemView);
  return {
    ChangePlanLayout: ChangePlanLayout,
    DomainSubscriptionView: DomainSubscriptionView,
    SelectedPlanView: SelectedPlanView,
    PaymentCardView: PaymentCardView,
    PaymentFormView: PaymentFormView
  };
});
