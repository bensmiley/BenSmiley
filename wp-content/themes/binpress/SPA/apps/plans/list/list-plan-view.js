// Generated by CoffeeScript 1.7.1
var __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

define(['marionette', 'text!apps/plans/templates/listPlanView.html', 'text!apps/plans/templates/beta-release.html'], function(Marionette, listPlanViewTpl, betaRelease) {
  var BetaReleaseView, PlansListView, SinglePlanView;
  SinglePlanView = (function(_super) {
    __extends(SinglePlanView, _super);

    function SinglePlanView() {
      return SinglePlanView.__super__.constructor.apply(this, arguments);
    }

    SinglePlanView.prototype.template = '<div class="text-center"> <h4 class="title1">{{plan_name}}</h4> <div class="content1" > <div class="price"><sup>&#36;</sup><span>{{price}}</span><sub>/month</sub> </div> </div> {{{description}}} <div class="pt-footer"> <a href="#change-plan/{{plan_id}}" class="plan-link">Subscribe</a> </div> </div>';

    SinglePlanView.prototype.tagName = 'li';

    SinglePlanView.prototype.className = 'plans';

    SinglePlanView.prototype.onShow = function() {
      var activePlanName, domainId, linkValue, newLinkValue, pendingSubscriptionId, planName;
      linkValue = this.$el.find('.plan-link').attr('href');
      domainId = Marionette.getOption(this, 'domainId');
      newLinkValue = "" + linkValue + "/" + domainId;
      this.$el.find('.plan-link').attr({
        'href': newLinkValue
      });
      activePlanName = Marionette.getOption(this, 'activePlanName');
      planName = this.model.get('plan_name');
      if (activePlanName === planName) {
        this.$el.addClass('highlight');
        this.$el.find('.plan-link').attr({
          'href': 'javascript:void(0)'
        });
      }
      pendingSubscriptionId = Marionette.getOption(this, 'pendingSubscriptionId');
      if (pendingSubscriptionId === 'BENAJFREE') {
        return this.$el.find('.plan-link').attr({
          'href': 'javascript:void(0)'
        });
      }
    };

    return SinglePlanView;

  })(Marionette.ItemView);
  PlansListView = (function(_super) {
    __extends(PlansListView, _super);

    function PlansListView() {
      return PlansListView.__super__.constructor.apply(this, arguments);
    }

    PlansListView.prototype.template = listPlanViewTpl;

    PlansListView.prototype.itemViewContainer = '.ca-menu';

    PlansListView.prototype.itemView = SinglePlanView;

    PlansListView.prototype.events = function() {
      return {
        'click #btn-cancel-paid-subscription': function() {
          var activeSubscriptionId, domainId;
          activeSubscriptionId = (this.model.get('active_subscription')).subscription_id;
          domainId = this.model.get('domain_id');
          return this.trigger("cancel:paid:subscription", activeSubscriptionId, domainId);
        }
      };
    };

    PlansListView.prototype.onShow = function() {
      var activeSubscriptionId, pendingSubscriptionId;
      activeSubscriptionId = (this.model.get('active_subscription')).subscription_id;
      if (activeSubscriptionId === 'BENAJFREE') {
        this.$el.find('#btn-cancel-paid-subscription').hide();
      }
      if (!_.isUndefined(this.model.get('pending_subscription'))) {
        pendingSubscriptionId = (this.model.get('pending_subscription')).subscription_id;
        if (pendingSubscriptionId === 'BENAJFREE') {
          return this.$el.find('#btn-cancel-paid-subscription').hide();
        }
      }
    };

    PlansListView.prototype.serializeData = function() {
      var data;
      data = PlansListView.__super__.serializeData.call(this);
      data.plan_name = (this.model.get('active_subscription')).plan_name;
      data.start_date = (this.model.get('active_subscription')).start_date;
      return data;
    };

    PlansListView.prototype.itemViewOptions = function() {
      var domainID, pendingSubscription, planName;
      planName = (this.model.get('active_subscription')).plan_name;
      domainID = Marionette.getOption(this, 'domainId');
      if (!_.isUndefined(this.model.get('pending_subscription'))) {
        pendingSubscription = (this.model.get('pending_subscription')).subscription_id;
      } else {
        pendingSubscription = void 0;
      }
      return {
        pendingSubscriptionId: pendingSubscription,
        activePlanName: planName,
        domainId: domainID
      };
    };

    PlansListView.prototype.onCancelSubscriptionMsg = function(msgText) {
      var msg;
      $('#btn-cancel-paid-subscription').hide();
      $('#success-msg').empty();
      msg = "<div class='alert alert-success'> <button class='close' data-dismiss='alert'>&times;</button>" + msgText + "<div>";
      return $('#success-msg').append(msg);
    };

    return PlansListView;

  })(Marionette.CompositeView);
  BetaReleaseView = (function(_super) {
    __extends(BetaReleaseView, _super);

    function BetaReleaseView() {
      return BetaReleaseView.__super__.constructor.apply(this, arguments);
    }

    BetaReleaseView.prototype.template = betaRelease;

    BetaReleaseView.prototype.initialize = function(opts) {
      return this.domainId = opts.domainID;
    };

    BetaReleaseView.prototype.mixinTemplateHelpers = function(data) {
      if (data == null) {
        data = {};
      }
      data.domain_id = this.domainId;
      return data;
    };

    return BetaReleaseView;

  })(Marionette.ItemView);
  return {
    PlansListView: PlansListView,
    BetaReleaseView: BetaReleaseView
  };
});
